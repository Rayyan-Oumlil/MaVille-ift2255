DEPLOY TO CLOUD RUN WITH SUPABASE (100% FREE)
==============================================

COST: $0/month (Cloud Run free tier + Supabase free tier)

STEP 1: CREATE SUPABASE DATABASE (5 minutes)
---------------------------------------------
1. Go to: https://supabase.com
2. Sign up with GitHub
3. Click "New Project"
4. Fill in:
   - Name: maville
   - Database Password: (create a strong password, save it!)
   - Region: Choose closest to you
5. Wait 2 minutes for database to be ready
6. Go to Project Settings > Database
7. Copy "Connection string" (URI format)
   Example: postgresql://postgres:YOUR_PASSWORD@db.xxx.supabase.co:5432/postgres

STEP 2: DEPLOY TO CLOUD RUN (10 minutes)
-----------------------------------------
1. Login to Google Cloud
   gcloud auth login

2. Create project (if not done)
   gcloud projects create maville-prod --name="MaVille"
   gcloud config set project maville-prod
   
   Enable billing: https://console.cloud.google.com/billing
   (Activate $300 student credit)

3. Enable APIs
   gcloud services enable run.googleapis.com
   gcloud services enable containerregistry.googleapis.com

4. Build Docker image
   gcloud auth configure-docker
   docker build -t gcr.io/maville-prod/maville-backend:latest .
   docker push gcr.io/maville-prod/maville-backend:latest

5. Deploy to Cloud Run
   gcloud run deploy maville-backend --image gcr.io/maville-prod/maville-backend:latest --platform managed --region us-central1 --allow-unauthenticated --set-env-vars "DATABASE_URL=YOUR_SUPABASE_CONNECTION_STRING" --set-env-vars "DATABASE_USER=postgres" --set-env-vars "DATABASE_PASSWORD=YOUR_SUPABASE_PASSWORD" --set-env-vars "CORS_ORIGINS=https://your-vercel-app.vercel.app,http://localhost:3000" --memory 512Mi --cpu 1 --min-instances 0 --max-instances 10 --timeout 300

   Replace:
   - YOUR_SUPABASE_CONNECTION_STRING (from step 1.7)
   - YOUR_SUPABASE_PASSWORD (from step 1.4)
   - your-vercel-app.vercel.app (your actual Vercel URL)

6. Get your Cloud Run URL
   gcloud run services describe maville-backend --platform managed --region us-central1 --format="value(status.url)"

7. Test
   curl YOUR_CLOUD_RUN_URL/api/health

8. Update Vercel
   Vercel Dashboard > Environment Variables
   NEXT_PUBLIC_API_URL = YOUR_CLOUD_RUN_URL
   Redeploy

DONE! Total cost: $0/month

